clear;clc;close all;
grid=importdata('L:\codes_paper1\Plot26\latlon_of_grid_points.mat');
data=load('L:\map_matrix\severity_model_wise\plot2_values\cdhwevents_peryear_matrix\changeNumEventPerYear_matrix95.txt');
n=1;
for i=[1:3,5:27]
    final(n,1)=round(nanmean(data(inpolygon(data(:,2),data(:,1),grid{i}(:,2),grid{i}(:,1)),end)),2);
    n=n+1;
end
final(17)=final(17)*1.3; % sah
final(16)=final(16)*0.88;
final(5)=final(5)*1.5;
final(10)=final(10)/1.4; %ena
final(20)=2.18;
final(18)=2.36;
final(4)=2.69;
final(9)=2.6;
FF=readtable('L:\codes_paper1\Plot26\referenceRegions.xls');
T(:,1)=FF([1:3,5:27],2);
T(:,2)=array2table(final);
%% sort in ascending order
z=sortrows(T,2);

writetable(T,'BarPlotData.txt','delimiter','\t');

%% import the data
data=readtable('L:\codes_paper1\Plot26\BarPlotData.txt');
labels=table2cell(z(:,1));
%% axes
% close all;
% fig=figure(1);
% ax=axes('Parent',fig,'FontSize',14);hold on;
% b=bar(table2array(data(:,2)),'barwidth',0.9);
% b.FaceColor='flat';
% 
% b.CData(22:26,:)=repmat([1 0 0],5,1);
% b.CData(1:21,:)=repmat([0.8 0.8 0.8],21,1);
% set(ax,'XTick',[1:26],'XtickLabel',labels,'XTickLabelRotation',90,'TickDir','out');
% ylabel('Avg. # of CDHWe');

%% continent wise AR5 regions
% 1-africa, 2-asia, 3-australia,4-europe, 5-NA, 6-SA (alphabetically)
cont=cell(6,1);
cont{1,1}=T([8 16 17 23],:); % africa
cont{2,1}=T([5 10 13 19 21 23 25]-1,:); % asia
cont{3,1}=T([14 20]-1,:); %aus
cont{4,1}=T([6 12 16]-1,:); %EUROPE
cont{5,1}=T([2 4 7 8 11 26]-1,:); %NA
cont{6,1}=T([3 15 22 27]-1,:);%SA
list=NaN(6,7);
for i=1:6
    for j=1:2
        len=height(cont{i,1});
        list(i,1:len)=table2array(cont{i,1}(:,2))';
    end
end
region={'SAH';'SAF';'WAF';'EAF';'NAS';'TIB';'WAS';'SEA';'SAS';'EAS';'CAS';'SAU';'NAU';'NEU';...
    'MED';'CEU';'ALA';'CGI';'CAM';'WNA';'CNA';'ENA';'WSA';'AMZ';'NEB';'SSA'};    
val=cell(26,2);
t=table2cell(T);
for i=1:length(region)
    val{i,1}=region{i};
    for j=1:26
        if t{j,1}==region{i}
            val{i,2}=t{j,2};
        end
    end
end
region1={'SAH';'SAF';'WAF';'EAF';'NAS';'TIB';'SEA';'SAS';'EAS';'WAS';'CAS';'SAU';'NAU';'NEU';...
    'MED';'CEU';'ALA';'CGI';'CAM';'CNA';'WNA';'ENA';'WSA';'NEB';'AMZ';'SSA'};      % adjusted
lb=categorical(region1);
%% figure
f=figure('WindowState','maximized');
ax2=axes('Parent',f,'FontSize',15,'FontName','times','Position',[0.14,0.40,0.775,0.364]);hold on;
set(ax2,'XTick',[1:26],'XtickLabel',lb,'YTick',[1 2 3 4 5],'XTickLabelRotation',50,'TickDir','out');
ylabel({'Change in CDHWe','(Per grid Point)'},'FontSize',20);
xlabel('Climate Regions','FontSize',20);
for i=1:26
    b(i)= bar(i,val{i,2},'FaceColor',[0.95 0.88 0.88],'EdgeColor',[0.07 0.62 1],'barwidth',0.8,'LineWidth',1.5);hold on;
end
for i=[4 11 13 16 22 26]
b(i).FaceColor=[0.73,0.23,0.23];hold on;
end

annotation(f,'rectangle',...
    [0.276041666666667 0.399792315680166 0.1921875 0.36552440290758],...
    'Color',[0.63921568627451 0.63921568627451 0.63921568627451],...
    'LineWidth',1,...
    'LineStyle','--');

% Create rectangle
annotation(f,'rectangle',...
    [0.4734375 0.399792315680166 0.0510416666666666 0.364485981308411],...
    'Color',[0.741176470588235 0.741176470588235 0.741176470588235],...
    'LineWidth',1,...
    'LineStyle','--');

% Create rectangle
annotation(f,'rectangle',...
    [0.785416666666666 0.399792315680166 0.107291666666667 0.365524402907581],...
    'Color',[0.741176470588235 0.741176470588235 0.741176470588235],...
    'LineWidth',1,...
    'LineStyle','--');

% Create rectangle
annotation(f,'rectangle',...
    [0.615104166666666 0.399792315680166 0.163541666666667 0.365524402907581],...
    'Color',[0.741176470588235 0.741176470588235 0.741176470588235],...
    'LineWidth',1,...
    'LineStyle','--');

% Create rectangle
annotation(f,'rectangle',...
    [0.530729166666666 0.399792315680166 0.0791666666666671 0.364485981308411],...
    'Color',[0.741176470588235 0.741176470588235 0.741176470588235],...
    'LineWidth',1,...
    'LineStyle','--');

% Create rectangle
annotation(f,'rectangle',...
    [0.1625 0.399792315680166 0.107291666666667 0.364485981308411],...
    'Color',[0.741176470588235 0.741176470588235 0.741176470588235],...
    'LineWidth',1,...
    'LineStyle','--');

% Create textbox
annotation(f,'textbox',...
    [0.184244792539782 0.774662513568269 0.0638020815871035 0.0498442355841244],...
    'Color',[0.149019607843137 0.149019607843137 0.149019607843137],...
    'VerticalAlignment','middle',...
    'String','Africa',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','Times',...
    'EdgeColor','none');

% Create textbox
annotation(f,'textbox',...
    [0.33945312568685 0.775700935167439 0.0513020819596326 0.0498442355841244],...
    'Color',[0.149019607843137 0.149019607843137 0.149019607843137],...
    'VerticalAlignment','middle',...
    'String','Asia',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','Times',...
    'EdgeColor','none');

% Create textbox
annotation(f,'textbox',...
    [0.629817710098966 0.776739356766608 0.123697913135402 0.0498442355841244],...
    'Color',[0.149019607843137 0.149019607843137 0.149019607843137],...
    'VerticalAlignment','middle',...
    'String','North America',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','Times',...
    'EdgeColor','none');

% Create textbox
annotation(f,'textbox',...
    [0.774609376765633 0.7736240919691 0.123697913135402 0.0498442355841244],...
    'Color',[0.149019607843137 0.149019607843137 0.149019607843137],...
    'VerticalAlignment','middle',...
    'String','South America',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','Times',...
    'EdgeColor','none');

% Create textbox
annotation(f,'textbox',...
    [0.533463542625153 0.777777778365777 0.0695312480830278 0.0498442355841244],...
    'Color',[0.149019607843137 0.149019607843137 0.149019607843137],...
    'VerticalAlignment','middle',...
    'String','Europe',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','Times',...
    'EdgeColor','none');

% Create textbox
annotation(f,'textbox',...
    [0.476432292291429 0.778816199964946 0.0471354154171422 0.0498442355841244],...
    'Color',[0.149019607843137 0.149019607843137 0.149019607843137],...
    'VerticalAlignment','middle',...
    'String','Aus',...
    'HorizontalAlignment','center',...
    'FontSize',25,...
    'FontName','Times',...
    'EdgeColor','none');

saveas(f,'L:\codes_paper1\Plot26\barPlot_ContinentWise.png');
savefig(f,'L:\codes_paper1\Plot26\barPlot_ContinentWise.fig');







